import { DeriveBuiltInParserHandlerFromDefinition } from '../../internals/createBuiltInParserDefinition.js';
import { RegisterViewParserDefinition } from './definition.js';

export const registerViewHandler: DeriveBuiltInParserHandlerFromDefinition<
  RegisterViewParserDefinition
> = async (previousResult, toolbox, parserOptions, _, _context) => {
  previousResult.engine.mutation.registerView({
    name: parserOptions.name,
    query: parserOptions.query,
    shouldSetActive: false,
  });

  toolbox.populateMessage({
    type: 'information',
    content: `SDTF view "${parserOptions.name}" has been registered.`,
  });

  return {
    type: 'SDTF Engine',
    engine: previousResult.engine,
  };
};
