import { SpecifyFontValue } from '@specifyapp/specify-design-token-format';
import path from 'node:path';

import { NonNullableOptions } from '../NonNullableOptions.js';
import { fontWeightValueToCss } from '../../../../converters/css/advanced.js';

const appendFontFormat = (fontFamily: string, fontsPath: string, format: string) => {
  if (format === 'eot') {
    return `url('${path.join(fontsPath, fontFamily)}.${format}')`;
  }

  return `url('${path.join(fontsPath, fontFamily)}.${format}') format('${format}')`;
};

export const fontValueToCssFontImport = (
  value: SpecifyFontValue,
  { formats, fontsPath, includeFontWeight, genericFamily, fontDisplay }: NonNullableOptions,
) => {
  const maybeFontWeight = includeFontWeight
    ? { 'font-weight': fontWeightValueToCss(value.weight) }
    : {};
  return {
    'font-family': genericFamily ? `'${value.family}', ${genericFamily}` : `'${value.family}'`,
    src: formats.map(format => appendFontFormat(value.family, fontsPath, format)).join(', '),
    'font-display': fontDisplay,
    ...maybeFontWeight,
  };
};
