import { SpecifyTextStyleValue } from '@specifyapp/specify-design-token-format';
import { renderFontWeight } from './fontWeight.js';
import { numberToDouble } from '../utils.js';
import { renderColor } from './color.js';
import { renderTextDecoration } from './textDecoration.js';
import { MultipleConversionOutput } from '../convertTokens.js';
import { renderTextAlignHorizontal } from './textAlignHorizontal.js';

export function renderTextStyle(
  textStyle: SpecifyTextStyleValue,
  variableName: string,
): MultipleConversionOutput {
  let baseTextStyle = `TextStyle(fontFamily: "${textStyle.font.postScriptName}", fontStyle: ${
    textStyle.font.style === 'italic' ? 'FontStyle.italic' : 'FontStyle.normal'
  }, fontWeight: ${renderFontWeight(textStyle.font.weight)}, fontSize: ${numberToDouble(
    textStyle.fontSize.value,
  )}`;

  if (!!textStyle.color) {
    const color = renderColor(textStyle.color);

    if (!!color) {
      baseTextStyle += `, color: ${color}`;
    }
  }

  if (!!textStyle.lineHeight) {
    const lineHeight = textStyle.lineHeight.value / textStyle.fontSize.value;

    baseTextStyle += `, height: ${numberToDouble(lineHeight)}`;
  }

  if (!!textStyle.letterSpacing)
    baseTextStyle += `, letterSpacing: ${numberToDouble(textStyle.letterSpacing.value)}`;

  if (!!textStyle.textDecoration)
    baseTextStyle += `, decoration: ${renderTextDecoration(textStyle.textDecoration)}`;

  baseTextStyle += ')';

  const values: MultipleConversionOutput = [
    { variableName, value: baseTextStyle, type: 'textStyle' },
  ];

  if (!!textStyle.textAlignHorizontal) {
    const align = renderTextAlignHorizontal(textStyle.textAlignHorizontal);

    if (!!align) {
      values.push({
        variableName: `${variableName}TextAlignHorizontal`,
        value: align,
        type: 'textAlignHorizontal',
      });
    }
  }

  return values;
}
