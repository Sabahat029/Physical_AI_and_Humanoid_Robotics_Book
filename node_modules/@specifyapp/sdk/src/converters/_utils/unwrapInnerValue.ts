import {
  InnerValue,
  ResolvableValueLevelAlias,
  UnresolvableValueLevelAlias,
} from '@specifyapp/specify-design-token-format';

import type { CssResolvableAliasStrategy, CssUnresolvableAliasStrategy } from '../css/index.js';

export function unwrapInnerValue<
  Value extends InnerValue<any, any, any>,
  Return = Value extends InnerValue<infer R, any, any>
    ? Exclude<R, UnresolvableValueLevelAlias | ResolvableValueLevelAlias>
    : never,
  UnresolvableReturn = undefined,
>(
  innerValue: Value,
  aliasStrategy: CssResolvableAliasStrategy,
  unresolvableAliasStrategy: CssUnresolvableAliasStrategy<UnresolvableReturn>,
): Return {
  return innerValue
    .mapResolvableValueLevelAlias(aliasStrategy)
    .mapUnresolvableValueLevelAlias(alias =>
      unresolvableAliasStrategy(innerValue.tokenState, alias),
    )
    .unwrap() as Return;
}
